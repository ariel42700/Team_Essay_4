---
title: "Team_Essay_4"
author: "Sahil, Ariel, Ilya, Lekha, Anthony, Trang"
date: "4/4/2021"
output: pdf_document
---

## Introduction

In this essay, our team will predict the species of a flower using the K Nearest Neighbors (KNN) algorithm. Given the sepal length, sepal width, petal length, and petal width in centimeters, we will classify the flower as either an Iris-setosa (ISE), Iris-versicolor (IVE), or Iris-virginica (IVI). Our dataset, flowers, contains 50 flowers from each of 3 species of iris. 

## Formula and Basics

Anthony

## Loading required R packages

```{r}
library("readxl")
library("class")
library("tidyverse")
library("gmodels")
library("flexplot")
library("caret")
```

## Data description

- Sepal_length: represents length of a flower's sepals
- Sepal_width: represents width of a flower's sepals
- Petal_length: represents length of a flower's petals
- Petal_width: represents width of a flower's petals 
- Species: indicates the species of the flower (Iris-setosa, Iris-versicolor, Iris-virginica)

## Examples of data and problem
```{r}
flower_data <- read_excel("IRIS.xlsx")
flower_data
```
## Visualization

```{r}
flowers <- read_excel("IRIS.xlsx")
stringsAsFactors = FALSE # This command helps to convert every character vector to a factor wherever it makes sense.
str(flowers) # We use this command to see whether the data is structured or not.
table(flowers$species) # It gives the number of indiviudal species

my_cols <- c("#00AFBB", "#E7B800", "#FC4E07")  
# Correlation panel
panel.cor <- function(x, y){
    usr <- par("usr"); on.exit(par(usr))
    par(usr = c(0, 1, 0, 1))
    r <- round(cor(x, y), digits=2)
    txt <- paste0("R = ", r)
    cex.cor <- 0.8/strwidth(txt)
    text(0.5, 0.5, txt, cex = cex.cor * r)
}
# Customize upper panel
upper.panel<-function(x, y){
  points(x,y, pch = 19, col = my_cols[flowers$species])
}
# Create the plots
pairs(flowers[,1:4], 
      lower.panel = panel.cor,
      upper.panel = upper.panel)
```
The scatter plot matrix above graphs all the pairs of predictor dimensions with the blue points representing the ISE species, the yellow points representing the IVE species, and the red points representing the IVI species. We observe that petal width and petal length are highly correlated with a value of R = 0.96 as well as sepal length and petal length with a value of R = 0.87.

## Analysis

## Computation and Model Evaluation

```{r}
# Random splitting of iris data as 70% train and 30% test datasets
ind <- sample(2, nrow(flowers), replace=TRUE, prob=c(0.7, 0.3))
trainData <- flowers[ind==1,]
testData <- flowers[ind==2,]

# Removing factor variable from training and test datasets
trainData1 <- trainData[-5]
testData1 <- testData[-5]

flowers_train_labels <- trainData$species # This shows how we classify our observation

flowers_test_labels <- testData$species # This shows how we classify our observation
```

## Model Assessment

```{r}
# k is taken by sqrt(number of data points)
flowers_test_pred1 <- knn(train = trainData1, test = testData1, cl= flowers_train_labels, k = 11, prob=TRUE) 
flowers_test_pred2 <- knn(train = trainData1, test = testData1, cl= flowers_train_labels, k = 12, prob=TRUE) 

# Model accuracy based on what k is
ACC.11 <- 100 * sum(flowers_test_labels == flowers_test_pred1)/NROW(flowers_test_labels)
ACC.12 <- 100 * sum(flowers_test_labels == flowers_test_pred2)/NROW(flowers_test_labels)

ACC.11
ACC.12

CrossTable(x = flowers_test_labels, y = flowers_test_pred2, prop.chisq=FALSE)
```

## Interpretation and Model Summary

 + We trained our model on 70% of our data set and tested it on the remaining 30%. Then, we tested the model's ability to predict     the species of a lilly given sepal length,  sepal width, petal length, and petal width. We did this by running a knn algorithm on   our testing sets and created a cross table to see how accurate our model's predictive capabilities are. We found that with k =      12, our model is 95% accurate.

## Prediction and Model Accuracy

  + The model accuracy when k = 11 is 93% and when k = 12 is 95%. So we see that k = 12 works better for our model.
  + The model predicts the setosa, versicolor and virginica correctly almost every time without giving any false predictions.
  + False predictions occur in case of predicting versicolor, where at times it is predicted as virginica or vice-versa.

## Conclusion

Lekha and Trang.

## Reference

Lekha and Trang.
https://rpubs.com/Drmadhu/IRISclassification